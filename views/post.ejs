<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VCC Confiesate</title>
    <link rel="stylesheet" href="/public/css/style.css"> 
    <link rel="stylesheet" href="/public/css/post.css">
    <link rel="icon" href="https://vcc.softromy.com/favicon.png">
    <link rel="stylesheet" href="../public/css/media.queryPost.css">
    <script src="https://kit.fontawesome.com/a8192839c1.js" crossorigin="anonymous"></script>
</head>

<body>
<header class="header">
    <span class="span-max">CONFIESATE</span>
    <a href="/" class="button">Inicio</a>
</header>

<section>

<!-- Título y descripción -->
<div class="titles">
    <h1 class="title-post"><%= post.titulo %></h1>
    <p class="descrip-post"><%= post.descripcion %></p>
</div>

<main class="main">
  <div class="conten-imgs carousel">
    <button id="prev"> < </button>
    <div class="img-container">

      <% post.imagenes.forEach((media, index) => { %>

        <% if (media.match(/\.mp4|\.webm|\.ogg|\.mkv$/)) { %>
          <video controls class="img-post" id="carousel-video-<%=index%>">
              <source src="<%= media %>" type="video/mp4">
          </video>

        <% } else { %>
          <img 
            src="<%= media %>" 
            class="img-post fullscreenable" 
            id="carousel-image-<%= index %>"
          >
        <% } %>

      <% }) %>

    </div>
    <button id="next"> > </button>
  </div>
</main>

<!-- Fullscreen modal -->
<div id="fullscreenModal" class="fullscreen-modal">
    <span class="close-modal">&times;</span>
    <img id="fullscreenImage" src="" alt="Imagen">
</div>

<!-- Comentarios -->
<div class="comentarios">
  <h2><%= comentarios.length %> comentarios</h2>

  <div class="conten-input">
      <img src="../prv/img/user.png" width="30">
      <form action="/confesion/<%= post._id %>/comentario" method="post" class="input-form">
          <input type="text" name="contenido" class="input" placeholder="Agregar un comentario..." required>
          <button type="submit" id="btn-comment">Comentar</button>
      </form>
  </div>

  <div class="as"></div>

  <div class="comments-conten">
      <% comentarios.forEach(comment => { %>
          <div class="comment-conten">
              <img src="../prv/img/user.png" width="20">
              <p class="comment-p"><%= comment.text %></p>
          </div>
          <div class="es"></div>
      <% }) %>
  </div>
</div>

</section>

<footer class="footer">
    <p>&copy; 2023 Confiesate Ccalamaquino</p>
</footer>

<script src="../public/js/post.js"></script>
<script>
    const fullscreenableImages = document.querySelectorAll('.fullscreenable');
    const modal = document.getElementById('fullscreenModal');
    const modalImg = document.getElementById('fullscreenImage');
    const closeModal = document.querySelector('.close-modal');

    fullscreenableImages.forEach(img => {
        img.addEventListener('click', () => {
            modal.style.display = 'flex';
            modalImg.src = img.src;
        });
    });

    closeModal.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

</script>

</body>
</html>